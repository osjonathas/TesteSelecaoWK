unit model.pedidovenda;

interface
  uses classes, System.StrUtils, System.SysUtils, Data.DB, FireDAC.Comp.Client, einterface.pedidovenda;

 type
   TPedidoVenda = class(TInterfacedObject, iPedidoVenda)
   private
     FFDQuery : TFDQuery;
     FCodigo: integer;
     FDataEmissao : TDateTime;
     FCodigoCliente : integer;
     FValorTotal : Currency;
   public
     Constructor Create;
     Destructor Destroy; override;

     class function New:iPedidoVenda;

     function NumeroPedido(Value: integer) :iPedidoVenda; overload;
     function NumeroPedido :integer; overload;

     function DataEmissao(Value: TDatetime) :iPedidoVenda; overload;
     function DataEmissao: TDateTime; overload;

     function CodigoCliente(Value: integer) :iPedidoVenda; overload;
     function CodigoCliente: integer; overload;

     function ValorTotal(Value: Currency) :iPedidoVenda; overload;
     function ValorTotal: Currency; overload;

     function Open(aDataSource : TDataSource; aFiltro : TStringList = nil):iPedidoVenda; overload;
     function getPedido(aCodigo:integer):iPedidoVenda; overload;
   end;

implementation
{ TPedidoVenda }

uses model.connection;

function TPedidoVenda.Codigo(Value: integer): iPedidoVenda;
begin
  Result := Self;
  FCodigo := Value;
end;

function TPedidoVenda.Codigo: integer;
begin
  Result := FCodigo;
end;

function TPedidoVenda.CodigoCliente(Value: integer): iPedidoVenda;
begin
  Result := Self;
  FCodigoCliente := Value;
end;

function TPedidoVenda.CodigoCliente: integer;
begin
  Result := FCodigoCliente;
end;

constructor TPedidoVenda.Create;
begin
  FFDQuery := TFDQuery.Create(nil);
end;

function TPedidoVenda.DataEmissao: TDateTime;
begin
  Result := FDataEmissao;
end;

function TPedidoVenda.DataEmissao(Value: TDatetime): iPedidoVenda;
begin
  Result := Self;
  FDataEmissao := Value;
end;

destructor TPedidoVenda.Destroy;
begin

  inherited;
end;

class function TPedidoVenda.New: iPedidoVenda;
begin
  Result := Self.Create;
end;

function TPedidoVenda.ValorTotal(Value: Currency): iPedidoVenda;
begin
  Result := Self;
  FValorTotal := Value;
end;

function TPedidoVenda.ValorTotal: Currency;
begin
  Result := FValorTotal;
end;

function TPedidoVenda.Open(aDataSource : TDataSource; aFiltro : TStringList = nil): iPedidoVenda;
begin
  try
    FFDQuery.Close;
    FFDQuery.Connection := connection.FDConnection;
    FFDQuery.Sql.Clear;
    FFDQuery.Sql.Add(' SELECT codigo, login, senha');
    FFDQuery.Sql.Add(' FROM Funcionarios');
    FFDQuery.Open();
    aDataSource.DataSet := FFDQuery;
    Result := self;

  except on E: Exception do
    raise;
  end;
end;      

function TPedidoVenda.getPedido(aCodigo: integer): iPedidoVenda;
begin
  try
    FFDQuery.Close;
    FFDQuery.Connection := connection.FDConnection;
    FFDQuery.Sql.Clear;
    FFDQuery.Sql.Add(' SELECT codigo, login, senha');
    FFDQuery.Sql.Add(' FROM Funcionarios');
    FFDQuery.Open();
    if not FFDQuery.IsEmpty then
    begin
      Self.Codigo(FFDQuery.FieldByName('codigo').AsInteger);
//      Self.Login(FFDQuery.FieldByName('login').AsString);
//      Self.Senha(FFDQuery.FieldByName('senha').AsString);
    end;
    Result := self;
  finally

  end;
end;
end.
